<!DOCTYPE html>
<html>
<head>
  <title></title>
  <!-- <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"> -->
  <!-- <link rel="stylesheet" type="text/css" href="file:///E:/trainer/express/chat.css"> -->
  <link rel="stylesheet" type="text/css" href="chat.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript" src ="http://code.jquery.com/jquery-latest.min.js"></script>
  <script type="text/javascript" src ="/socket.io/socket.io.js"></script>
  <!-- <script type="text/javascript" src ="http://code.jquery.com/jquery-latest.min.js"></script> -->
  <style type="text/css">
    #messageArea{
      display: none;
    }
  </style>
</head>
<body>

  <div class="container-login"  id="userFormArea">
          <form id="userForm">
            <div>
              <!-- <label>username</label> -->
              <input type="text" id="username" placeholder="username">
              <br />
              <input type="submit" name="btn btn-primary" value="Login">
            </div>
          </form>
      
    </div>
    <div class="container clearfix" id="messageArea">
    <input type="hidden" class="form-control" id="myid"></input>
    <div class="people-list" id="people-list">
      <div class="search">
        <input type="text" placeholder="search" class="people-list-input" />
        <i class="fa fa-search"></i>
      </div>
      <ul class="people-list-ul" id="users">
        <!-- <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_01.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Vincent Porter</div>
            <div class="status">
              <i class="fa fa-circle-o online"></i> online
            </div>
          </div>
        </li> -->
        
       <!--  <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_02.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Aiden Chavez</div>
            <div class="status">
              <i class="fa fa-circle offline"></i> left 7 mins ago
            </div>
          </div>
        </li>
        
        <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_03.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Mike Thomas</div>
            <div class="status">
              <i class="fa fa-circle online"></i> online
            </div>
          </div>
        </li>
        
        <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_04.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Erica Hughes</div>
            <div class="status">
              <i class="fa fa-circle online"></i> online
            </div>
          </div>
        </li>
        
        <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_05.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Ginger Johnston</div>
            <div class="status">
              <i class="fa fa-circle online"></i> online
            </div>
          </div>
        </li>
        
        <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_06.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Tracy Carpenter</div>
            <div class="status">
              <i class="fa fa-circle offline"></i> left 30 mins ago
            </div>
          </div>
        </li>
        
        <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_07.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Christian Kelly</div>
            <div class="status">
              <i class="fa fa-circle offline"></i> left 10 hours ago
            </div>
          </div>
        </li>
        
        <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_08.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Monica Ward</div>
            <div class="status">
              <i class="fa fa-circle online"></i> online
            </div>
          </div>
        </li>
        
        <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_09.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Dean Henry</div>
            <div class="status">
              <i class="fa fa-circle offline"></i> offline since Oct 28
            </div>
          </div>
        </li>
        
        <li class="clearfix le-clear">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_10.jpg" alt="avatar" />
          <div class="about">
            <div class="name">Peyton Mckinney</div>
            <div class="status">
              <i class="fa fa-circle online"></i> online
            </div>
          </div>
        </li> -->
      </ul>
    </div>
    
    <div class="chat">
      <div class="chat-header clearfix">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_01_green.jpg" alt="avatar" class="chat-header-img" />
        
        <div class="chat-about">
          <div class="chat-with">Chat with Vincent Porter</div>
          <div class="chat-num-messages">already 1 902 messages</div>
        </div>
        <i class="fa fa-star"></i>
      </div> <!-- end chat-header -->
      
      <div class="chat-history">
        <ul id="chat">
          <!-- <li class="clearfix li-chat">
            <div class="message-data align-right">
              <span class="message-data-time" >10:10 AM, Today</span> &nbsp; &nbsp;
              <span class="message-data-name" >Olia</span> <i class="fa fa-circle me"></i>
              
            </div>
            <div class="message other-message float-right">
              Hi Vincent, how are you? How is the project coming along?
            </div>
          </li>
          
          <li class="li-chat  ">
            <div class="message-data">
              <span class="message-data-name"><i class="fa fa-circle online"></i> Vincent</span>
              <span class="message-data-time">10:12 AM, Today</span>
            </div>
            <div class="message my-message">
              Are we meeting today? Project has been already finished and I have results to show you.
            </div>
          </li> -->
          
          <!-- <li class="clearfix li-chat">
            <div class="message-data align-right">
              <span class="message-data-time" >10:14 AM, Today</span> &nbsp; &nbsp;
              <span class="message-data-name" >Olia</span> <i class="fa fa-circle me"></i>
              
            </div>
            <div class="message other-message float-right">
              Well I am not sure. The rest of the team is not here yet. Maybe in an hour or so? Have you faced any problems at the last phase of the project?
            </div>
          </li>
          
          <li class="li-chat">
            <div class="message-data">
              <span class="message-data-name"><i class="fa fa-circle online"></i> Vincent</span>
              <span class="message-data-time">10:20 AM, Today</span>
            </div>
            <div class="message my-message">
              Actually everything was fine. I'm very excited to show this to our team.
            </div>
          </li>
          
          <li class="li-chat">
            <div class="message-data">
              <span class="message-data-name"><i class="fa fa-circle online"></i> Vincent</span>
              <span class="message-data-time">10:31 AM, Today</span>
            </div>
            <i class="fa fa-circle online"></i>
            <i class="fa fa-circle online" style="color: #AED2A6"></i>
            <i class="fa fa-circle online" style="color:#DAE9DA"></i>
          </li> -->
          
        </ul>
        
      </div> <!-- end chat-history -->
      <form id="messageForm">
        <div class="chat-message clearfix">

          <textarea name="message-to-send" id="message" placeholder ="Type your message" rows="3" class="chat-message-textarea"s></textarea>
                
          
          <input type="submit" name="btn btn-primary" value="Send"/>

        </div> <!-- end chat-message -->
      </form>
      
      
    </div> <!-- end chat -->
    
  </div> <!-- end container -->

<script id="message-template" type="text/x-handlebars-template">
  <li class="clearfix">
    <div class="message-data align-right">
      <span class="message-data-time" >{{time}}, Today</span> &nbsp; &nbsp;
      <span class="message-data-name" >Olia</span> <i class="fa fa-circle me"></i>
    </div>
    <div class="message other-message float-right">
      {{messageOutput}}
    </div>
  </li>
</script>

<script id="message-response-template" type="text/x-handlebars-template">
  <li>
    <div class="message-data">
      <span class="message-data-name"><i class="fa fa-circle online"></i> Vincent</span>
      <span class="message-data-time">{{time}}, Today</span>
    </div>
    <div class="message my-message">
      {{response}}
    </div>
  </li>
</script>

<script type="text/javascript">
  $(function(){
    var socket = io.connect();
    var $messageForm = $('#messageForm');
    var $message = $('#message');
    var $chat = $('#chat');
    var $messageArea = $('#messageArea');
    var $userFormArea = $('#userFormArea');
    var $username = $('#username');
    var $userForm = $('#userForm');
    var $users = $('#users');
    var $me = $('#me');
    var $myid = $('#myid');

    // var aku = $me.val();


    $messageForm.submit(function(e){
      e.preventDefault();
      socket.emit('send message', $message.val());
      $message.val('');
      // console.log('submited');
    });



    socket.on('new message', function(data){
      console.log($myid.val());
      var identity = '';
      var styletitle ='';
      var stylemsg ='';
      var stylestatus ='';
      if(data.user == $myid.val()){
        identity = 'Me';
        styletitle = 'class="message-data align-right"';
        stylemsg = 'class="message other-message float-right"';
        stylestatus = 'class="fa fa-circle me"';
      }
      else{
        identity = data.user;
        styletitle = 'class="message-data"';
        stylemsg = 'class="message my-message"';
        stylestatus = 'class="fa fa-circle online"';
      }
      // $chat.append('<li class="well" ' +style+' ><strong>'+identity+'</strong> '+data.msg+'</li>')
      $chat.append(
          '<li class="clearfix li-chat">'+
            '<div '+styletitle+'>'+
              '<span class="message-data-time" >10:10 AM, Today</span> &nbsp; &nbsp;'+
              '<span class="message-data-name" >'+identity+'</span> <i '+stylestatus+'></i>'+
            '</div>'+
            '<div '+stylemsg+'>'+
              data.msg+
            '</div>'+
          '</li>'
        )
    });

    $userForm.submit(function(e){
      e.preventDefault();
      socket.emit('new user', $username.val(),function(data){
        if(data){
          $userFormArea.hide();
          $messageArea.show();
          
        }
      });
      var htmlme = '<h3>'+$username.val()+'</h3>';
      $me.html(htmlme);
      $myid.val($username.val());
      $username.val('');

      // console.log('submited');
    });

    socket.on('get users', function(data){
      var html = '';
      for(i = 0;i<data.length;i++){
        // html +='<li class="list-group-item">'+data[i]+' </li>'
        html += '<li class="clearfix le-clear">'+
          '<img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_01.jpg" alt="avatar" />'+
          '<div class="about">'+
            '<div class="name">'+data[i]+'</div>'+
            '<div class="status">'+
              '<i class="fa fa-circle-o online"></i> online'+
            '</div>'+
          '</div>'+
        '</li>'
      }

      $users.html(html);
    });
  })
</script>
<!-- <script type="text/javascript" src="file:///E:/trainer/express/animation.js"></script> -->
</body>
</html>